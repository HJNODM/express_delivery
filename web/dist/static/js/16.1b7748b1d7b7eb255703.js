webpackJsonp([16],{tn9i:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("gUGA"),n=s.n(a),i=s("aozt"),r=s.n(i),o=s("6T4k"),c={data:function(){return{activeName:"",userMessage:[],loading:null,currentPage:1,pageSize:13,totalOrder:0,showPagination:!0}},mounted:function(){this.getMessage()},methods:{getMessage:function(){var e=this,t=this.$loading({lock:!0,text:"玩命加载中..."});r.a.get("/users/userMessage?size="+this.pageSize+"&page="+this.currentPage).then(function(s){var a=s.data;if(t.close(),"0"==a.status){e.userMessage=a.result.userMessage,e.totalOrder=n()(a.result.totalOrder),e.totalOrder<=e.pageSize&&(e.showPagination=!1);var i=a.result.notRead;i||e.$store.commit("saveUserInfo",{msgLen:i.length})}else e.$message({type:"error",message:a.msg})}).catch(function(e){})},handleReadMsg:function(e){var t=this,s=this.userMessage.filter(function(t){return!t.isRead&&t.title==e});""!=e&&s.length&&r.a.get("/users/readMessage?title="+e).then(function(e){var s=e.data;"0"==s.status&&(t.getMessage(),o.a.$emit("readMessage"))}).catch(function(e){})},handleDeleteMessage:function(e){var t=this;this.$confirm("此操作将永久删除该消息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){r.a.get("/users/deleteMessage?title="+e).then(function(e){var s=e.data;"0"==s.status?(t.$message({type:"success",message:"删除成功!"}),1===t.totalOrder%t.pageSize&&t.currentPage--,t.getMessage()):t.$message({type:"error",message:s.msg})}).catch(function(e){})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},handleCurrentChange:function(e){this.currentPage=e,this.getMessage()}}},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"myMessage"},[s("person-title",[e._v("我的消息 >> "),s("em",[e._v("消息")])]),e._v(" "),s("div",{staticClass:"myMessage-cont"},[s("el-collapse",{attrs:{accordion:""},on:{change:e.handleReadMsg},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.userMessage,function(t){return s("el-collapse-item",{key:t.title,class:{messageIsRead:t.isRead},attrs:{title:t.title,name:t.title}},[s("template",{slot:"title"},[s("i",{staticClass:"el-icon-message"}),e._v("\n                "+e._s(t.title)+"\n                ( "+e._s(t.isRead?"已读":"未读")+" )\n                ")]),e._v(" "),s("p",{staticClass:"msg-body"},[e._v("\n                    "+e._s(t.cont)+" "),s("br"),e._v(" "),s("span",[e._v("(发送时间 : "+e._s(t.sendTime)+")")]),e._v(" "),s("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(s){e.handleDeleteMessage(t.title)}}})],1)],2)}),1)],1),e._v(" "),s("div",{staticClass:"pageination-oder"},[e.showPagination?s("el-pagination",{attrs:{background:"","current-page":e.currentPage,"pager-count":5,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.totalOrder},on:{"current-change":e.handleCurrentChange}}):e._e()],1)],1)},staticRenderFns:[]};var g=s("C7Lr")(c,l,!1,function(e){s("z6X0")},null,null);t.default=g.exports},z6X0:function(e,t){}});